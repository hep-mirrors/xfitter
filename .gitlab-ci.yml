variables:
  GIT_STRATEGY: fetch
  GIT_SUBMODULE_STRATEGY: recursive
  GIT_SSL_NO_VERIFY: "true"

stages:
- compile-minimal

.build_template: &build_template
  stage: compile-minimal
  only:
    - merge_requests
    - schedules
  script:
    - ./make.sh install
  variables:
    CMAKE_FLAGS: "-DCMAKE_DISABLE_FIND_PACKAGE_ROOT=TRUE"

build_centos7:
  image: centos:centos7
  before_script:
    - yum -q -y update
    - yum -y install epel-release gcc gcc-c++ gcc-gfortran blas blas-devel lapack lapack-devel boost-devel
    - yum -y install yum-plugin-ovl which yaml-cpp-devel libyaml-devel gsl-devel cmake3 automake libtool
    - ln -s /usr/bin/cmake3 /usr/bin/cmake 
  <<: *build_template

build_centos8:
  image: centos:centos8
  before_script:
    - yum -q -y update
    - yum -y install epel-release gcc gcc-c++ gcc-gfortran blas lapack boost-devel
    - yum -y install  yum-plugin-ovl which yaml-cpp-devel libyaml-devel gsl-devel cmake automake libtool
#    - ln -s /usr/bin/cmake3 /usr/bin/cmake
  <<: *build_template

build_ubuntu:
  image: ubuntu:20.04
  before_script:
    - export DEBIAN_FRONTEND=noninteractive
    - apt-get update -qq -y
    - apt-get install -y wget cmake automake libtool libyaml-dev libyaml-cpp-dev g++ gfortran
    - apt-get -y autoremove
    - apt-get -y autoclean
  <<: *build_template

build_ubuntu_clang:
  image: clangbuiltlinux/ubuntu
  before_script:
    - export DEBIAN_FRONTEND=noninteractive
    - apt-get update -qq -y
    - apt-get install -y wget cmake automake libtool libyaml-dev libyaml-cpp-dev g++ gfortran
    - apt-get -y autoremove
    - apt-get -y autoclean
  <<: *build_template

#build_fedora:
#  image: fedora:32
#  <<: *build_template


